<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rysu V2</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

<style>
:root{
--bg:#0b0b10;
--card:#14141c;
--neon:#00f2ff;
}

body{
margin:0;
background:var(--bg);
font-family:Segoe UI;
color:white;
display:flex;
height:100vh;
overflow:hidden;
}

/* REGISTER */
#register{
position:fixed;
inset:0;
background:black;
display:flex;
align-items:center;
justify-content:center;
z-index:999;
}

.box{
background:var(--card);
padding:40px;
border-radius:20px;
display:flex;
flex-direction:column;
gap:15px;
width:300px;
}

input{
background:#222;
border:none;
padding:12px;
border-radius:12px;
color:white;
}

button{
background:var(--neon);
border:none;
padding:12px;
border-radius:12px;
cursor:pointer;
font-weight:bold;
}

.chat{
flex:1;
display:flex;
flex-direction:column;
}

.messages{
flex:1;
overflow-y:auto;
padding:20px;
display:flex;
flex-direction:column;
gap:15px;
}

.msg{
background:#14141c;
padding:12px;
border-radius:15px;
}

.input-bar{
display:flex;
gap:10px;
padding:15px;
background:#111;
}
</style>
</head>

<body>

<div id="register">
<div class="box">
<h2>Rysu</h2>
<input type="text" id="username" placeholder="Kullanıcı adı">
<input type="password" id="password" placeholder="Şifre">
<button onclick="registerUser()">Başla</button>
</div>
</div>

<div class="chat">
<div class="messages" id="messages"></div>

<div class="input-bar">
<input type="text" id="msgInput" placeholder="Mesaj yaz...">
<button onclick="sendMessage()">Gönder</button>
<input type="file" id="fileInput">
</div>
</div>

<script>
const firebaseConfig={
apiKey:"APIKEY",
authDomain:"DOMAIN",
databaseURL:"DBURL",
projectId:"PID",
storageBucket:"BUCKET",
appId:"APPID"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const storage=firebase.storage();

let currentUser=null;

/* AUTO LOGIN */
window.onload=()=>{
const saved=localStorage.getItem("rysu_user");
if(saved){
currentUser=JSON.parse(saved);
document.getElementById("register").style.display="none";
listenMessages();
}
};

/* REGISTER */
function registerUser(){
const u=username.value.trim();
const p=password.value.trim();
if(!u||!p)return alert("Boş bırakma");

db.ref("users/"+u).once("value").then(snap=>{
if(snap.exists()){
alert("Bu kullanıcı adı alınmış");
return;
}

db.ref("users/"+u).set({
password:p,
avatar:"",
created:Date.now()
});

currentUser={name:u};
localStorage.setItem("rysu_user",JSON.stringify(currentUser));

document.getElementById("register").style.display="none";
listenMessages();
});
}

/* SEND MESSAGE */
function sendMessage(){
const text=msgInput.value;
if(!text)return;

db.ref("messages/global").push({
user:currentUser.name,
text:text,
time:Date.now()
});

msgInput.value="";
}

/* LISTEN */
function listenMessages(){
db.ref("messages/global").on("value",snap=>{
messages.innerHTML="";
snap.forEach(m=>{
const d=m.val();
messages.innerHTML+=`
<div class="msg">
<b>${d.user}</b><br>
${d.text}
</div>
`;
});
});
}

/* FILE UPLOAD */
fileInput.addEventListener("change",e=>{
const file=e.target.files[0];
const ref=storage.ref("files/"+Date.now()+"_"+file.name);

ref.put(file).then(s=>{
s.ref.getDownloadURL().then(url=>{
db.ref("messages/global").push({
user:currentUser.name,
text:"<a href='"+url+"' target='_blank'>Dosya</a>"
});
});
});
});
</script>

</body>
</html>