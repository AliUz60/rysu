<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rysu | Sosyal Medya</title>
    <style>
        :root {
            --bg: #313338; --sidebar: #2b2d31; --dark: #1e1f22;
            --accent: #5865f2; --text: #dbdee1; --input: #383a40;
        }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }
        
        /* Auth Ekranı */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .auth-box { background: #1e1f22; padding: 32px; border-radius: 8px; width: 400px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .auth-box input { width: 90%; padding: 12px; margin: 10px 0; background: var(--input); border: none; color: white; border-radius: 4px; }
        .auth-box button { background: var(--accent); color: white; border: none; padding: 12px; width: 96%; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        /* Profil Resmi Seçici */
        .pfp-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .pfp-option { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .pfp-option.selected { border-color: var(--accent); transform: scale(1.1); }

        /* Ana Uygulama */
        #app { display: none; width: 100%; height: 100%; }
        .sidebar { width: 260px; background: var(--sidebar); display: flex; flex-direction: column; }
        .chat-area { flex: 1; display: flex; flex-direction: column; }
        .messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg-bubble { background: #383a40; padding: 10px; border-radius: 8px; max-width: 80%; }
        .input-area { padding: 20px; background: var(--bg); }
        .input-area input { width: 100%; background: var(--input); border: none; padding: 15px; color: white; border-radius: 8px; outline: none; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box" id="register-box">
            <h2>Rysu'ya Katıl</h2>
            <div class="pfp-selector" id="pfp-list">
                </div>
            <input type="text" id="reg-username" placeholder="Kullanıcı Adı">
            <input type="email" id="reg-email" placeholder="E-posta">
            <input type="password" id="reg-pass" placeholder="Şifre">
            <button id="btn-register">Kayıt Ol</button>
            <p style="cursor:pointer; font-size:14px;" id="to-login">Zaten hesabın var mı? Giriş yap</p>
        </div>
        <div class="auth-box" id="login-box" style="display:none">
            <h2>Tekrar Hoş Geldin!</h2>
            <input type="email" id="log-email" placeholder="E-posta">
            <input type="password" id="log-pass" placeholder="Şifre">
            <button id="btn-login">Giriş Yap</button>
            <p style="cursor:pointer; font-size:14px;" id="to-register">Hesap oluştur</p>
        </div>
    </div>

    <div id="app">
        <div class="sidebar">
            <div style="padding: 20px; font-weight: bold; font-size: 20px; border-bottom: 1px solid #202225;">RYSU</div>
            <div style="padding: 15px; flex: 1;">
                <p style="font-size: 12px; color: #949ba4; font-weight: bold;">ARKADAŞ EKLE</p>
                <input type="text" id="friend-input" placeholder="Kullanıcı adı..." style="width: 85%; background: var(--dark); border:none; padding:8px; color:white; border-radius:4px;">
                <div id="friends-list" style="margin-top: 20px;"></div>
            </div>
            <div id="user-bar" style="padding: 10px; background: #232428; display:flex; align-items:center; gap:10px;">
                <img id="my-pfp" src="" style="width:32px; height:32px; border-radius:50%;">
                <span id="my-username" style="font-weight:bold; font-size:14px;">Yükleniyor...</span>
                <button id="btn-logout" style="margin-left:auto; background:none; border:none; color:#ed4245; cursor:pointer;">Çıkış</button>
            </div>
        </div>
        <div class="chat-area">
            <div class="chat-header" style="padding: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"># genel-sohbet</div>
            <div class="messages" id="msg-list"></div>
            <div class="input-area">
                <input type="text" id="msg-input" placeholder="Mesajınızı gönderin...">
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, push, onValue, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Senin verdiğin config
        const firebaseConfig = {
            apiKey: "AIzaSyCXca2LRaHFx6iZX9vhfe6lXMS9UY5nO54",
            authDomain: "rysu-server.firebaseapp.com",
            projectId: "rysu-server",
            storageBucket: "rysu-server.firebasestorage.app",
            messagingSenderId: "253844771451",
            appId: "1:253844771451:web:bd370ae5a93eae66fcc8de",
            measurementId: "G-T632DDDX6L"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let selectedPfp = "https://api.dicebear.com/7.x/adventurer/svg?seed=Felix";

        // Profil Resmi Seçeneklerini Oluştur
        const pfpList = document.getElementById('pfp-list');
        ["Felix", "Aneka", "Milo", "Luna"].forEach(seed => {
            const img = document.createElement('img');
            img.src = `https://api.dicebear.com/7.x/adventurer/svg?seed=${seed}`;
            img.className = 'pfp-option';
            img.onclick = () => {
                document.querySelectorAll('.pfp-option').forEach(el => el.classList.remove('selected'));
                img.classList.add('selected');
                selectedPfp = img.src;
            };
            pfpList.appendChild(img);
        });

        // OTOMATİK GİRİŞ (Auto-Login)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                const userRef = ref(db, 'users/' + user.uid);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    if(data) {
                        document.getElementById('my-username').innerText = data.username;
                        document.getElementById('my-pfp').src = data.pfp;
                    }
                });
                loadMessages();
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('app').style.display = 'none';
            }
        });

        // KAYIT FONKSİYONU
        document.getElementById('btn-register').onclick = async () => {
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            const username = document.getElementById('reg-username').value;

            try {
                const result = await createUserWithEmailAndPassword(auth, email, pass);
                await set(ref(db, 'users/' + result.user.uid), {
                    username: username,
                    pfp: selectedPfp,
                    email: email
                });
            } catch (err) { alert("Hata: " + err.message); }
        };

        // GİRİŞ FONKSİYONU
        document.getElementById('btn-login').onclick = () => {
            const email = document.getElementById('log-email').value;
            const pass = document.getElementById('log-pass').value;
            signInWithEmailAndPassword(auth, email, pass).catch(err => alert(err.message));
        };

        // ÇIKIŞ
        document.getElementById('btn-logout').onclick = () => signOut(auth);

        // MESAJ GÖNDERME
        document.getElementById('msg-input').onkeypress = (e) => {
            if(e.key === 'Enter' && e.target.value.trim() !== "") {
                const msgRef = ref(db, 'messages');
                push(msgRef, {
                    sender: document.getElementById('my-username').innerText,
                    text: e.target.value,
                    timestamp: Date.now()
                });
                e.target.value = "";
            }
        };

        // MESAJLARI DİNLE
        function loadMessages() {
            const msgRef = ref(db, 'messages');
            onValue(msgRef, (snapshot) => {
                const list = document.getElementById('msg-list');
                list.innerHTML = "";
                snapshot.forEach(child => {
                    const data = child.val();
                    const div = document.createElement('div');
                    div.className = 'msg-bubble';
                    div.innerHTML = `<small style="color:var(--accent)">${data.sender}</small><br>${data.text}`;
                    list.appendChild(div);
                });
                list.scrollTop = list.scrollHeight;
            });
        }

        // Ekranlar Arası Geçiş
        document.getElementById('to-login').onclick = () => {
            document.getElementById('register-box').style.display = 'none';
            document.getElementById('login-box').style.display = 'block';
        };
        document.getElementById('to-register').onclick = () => {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('register-box').style.display = 'block';
        };
    </script>
</body>
</html>