<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rysu V2</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

<style>
:root{
--bg:#0b0b10;
--card:#14141c;
--neon:#00f2ff;
--accent:#bc4eff;
}

body{
margin:0;
background:var(--bg);
font-family:Segoe UI;
color:white;
display:flex;
height:100vh;
overflow:hidden;
}

/* LOGIN */
#login{
position:fixed;
inset:0;
background:black;
display:flex;
align-items:center;
justify-content:center;
z-index:999;
}

.login-box{
background:var(--card);
padding:40px;
border-radius:20px;
display:flex;
flex-direction:column;
gap:15px;
width:300px;
}

input{
background:#222;
border:none;
padding:12px;
border-radius:12px;
color:white;
}

button{
background:var(--neon);
border:none;
padding:12px;
border-radius:12px;
cursor:pointer;
font-weight:bold;
}

.chat{
flex:1;
display:flex;
flex-direction:column;
}

.messages{
flex:1;
overflow-y:auto;
padding:20px;
display:flex;
flex-direction:column;
gap:15px;
}

.msg{
background:#14141c;
padding:12px;
border-radius:15px;
}

.input-bar{
display:flex;
gap:10px;
padding:15px;
background:#111;
}
</style>
</head>

<body>

<div id="login">
<div class="login-box">
<h2>Rysu</h2>
<input type="text" id="username" placeholder="Kullanıcı adı">
<input type="password" id="password" placeholder="Şifre">
<button onclick="register()">Kayıt Ol</button>
<button onclick="login()">Giriş Yap</button>
</div>
</div>

<div class="chat">
<div class="messages" id="messages"></div>

<div class="input-bar">
<input type="text" id="msgInput" placeholder="Mesaj yaz...">
<button onclick="sendMessage()">Gönder</button>
<input type="file" id="fileInput">
</div>
</div>

<script>
const firebaseConfig={
apiKey:"APIKEY",
authDomain:"DOMAIN",
databaseURL:"DBURL",
projectId:"PID",
storageBucket:"BUCKET",
appId:"APPID"
};

firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();

let user;

function fakeEmail(username){
return username+"@rysu.app";
}

function register(){
const u=username.value.trim();
const p=password.value.trim();
if(!u||!p)return alert("Boş bırakma");

auth.createUserWithEmailAndPassword(fakeEmail(u),p)
.then(()=>{
db.ref("users/"+auth.currentUser.uid).set({
name:u,
avatar:"",
online:true
});
})
.catch(e=>alert(e.message));
}

function login(){
const u=username.value.trim();
const p=password.value.trim();

auth.signInWithEmailAndPassword(fakeEmail(u),p)
.catch(e=>alert("Hatalı giriş"));
}

auth.onAuthStateChanged(u=>{
if(u){
user=u;
document.getElementById("login").style.display="none";
listenMessages();
}
});

function sendMessage(){
const text=msgInput.value;
if(!text)return;

db.ref("messages/global").push({
uid:user.uid,
text:text,
time:Date.now()
});
msgInput.value="";
}

function listenMessages(){
db.ref("messages/global").on("value",snap=>{
messages.innerHTML="";
snap.forEach(m=>{
const d=m.val();
db.ref("users/"+d.uid).once("value").then(u=>{
const data=u.val();
messages.innerHTML+=`
<div class="msg">
<b>${data.name}</b><br>
${d.text}
</div>
`;
});
});
});
}

/* DOSYA */
fileInput.addEventListener("change",e=>{
const file=e.target.files[0];
const ref=storage.ref("files/"+Date.now()+"_"+file.name);
ref.put(file).then(s=>{
s.ref.getDownloadURL().then(url=>{
db.ref("messages/global").push({
uid:user.uid,
text:"<a href='"+url+"' target='_blank'>Dosya</a>"
});
});
});
});
</script>

</body>
</html>