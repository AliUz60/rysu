<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rysu | Global</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <style>
        :root {
            --bg-main: #0a0a0c;
            --glass: rgba(255, 255, 255, 0.05);
            --neon: #00f2ff; /* Yeni Neon Turkuaz */
            --accent: #7d5fff;
            --text: #e1e1e6;
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-main); color: var(--text); height: 100vh; display: flex; overflow: hidden; }

        /* --- ≈ûEKƒ∞LLƒ∞ RYSU LOGOSU --- */
        .rysu-logo-wrapper {
            position: relative; width: 50px; height: 50px; margin-bottom: 20px; cursor: pointer;
        }
        .rysu-shape {
            position: absolute; inset: 0; background: linear-gradient(135deg, var(--neon), var(--accent));
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); /* Hexagon ≈ûekli */
            display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 22px; color: #000;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.5); transition: 0.3s;
        }
        .rysu-logo-wrapper:hover .rysu-shape { transform: rotate(10deg) scale(1.1); }

        /* --- MODAL (Sunucu Adƒ± Girin Ekranƒ±) --- */
        #server-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal-box { background: #16161a; padding: 30px; border-radius: 20px; border: 1px solid var(--neon); text-align: center; width: 350px; }
        .modal-box input { width: 90%; padding: 12px; margin: 15px 0; background: #0a0a0c; border: 1px solid #333; color: white; border-radius: 8px; outline: none; }

        /* --- SIDEBARLAR --- */
        .server-sidebar { width: 72px; background: #050505; display: flex; flex-direction: column; align-items: center; padding: 15px 0; gap: 12px; border-right: 1px solid #111; }
        .server-btn { width: 48px; height: 48px; background: var(--glass); border-radius: 16px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.05); }
        .server-btn:hover { border-color: var(--neon); background: rgba(0, 242, 255, 0.1); }

        .channel-sidebar { width: 240px; background: #0f0f13; border-right: 1px solid #111; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #111; font-weight: bold; display: flex; justify-content: space-between; align-items: center; color: var(--neon); }

        /* --- MESAJ ALANI --- */
        .main-chat { flex: 1; display: flex; flex-direction: column; }
        .messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg { display: flex; gap: 12px; }
        .msg img.pfp { width: 40px; height: 40px; border-radius: 10px; }
        .msg-content { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.02); }
        .msg-content b { color: var(--neon); font-size: 13px; display: block; margin-bottom: 4px; }
        .shared-img { max-width: 300px; border-radius: 10px; margin-top: 8px; border: 1px solid #333; }

        /* --- INPUT VE DOSYA --- */
        .input-area { padding: 20px; display: flex; gap: 10px; align-items: center; }
        .input-container { flex: 1; background: #16161a; padding: 12px 18px; border-radius: 12px; display: flex; border: 1px solid #222; }
        .input-container input { background: transparent; border: none; color: white; flex: 1; outline: none; }
        .file-btn { cursor: pointer; font-size: 20px; color: var(--neon); transition: 0.3s; }
        .file-btn:hover { transform: scale(1.2); }

        .action-btn { background: var(--neon); color: #000; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 11000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="modal-box" style="width: 300px;">
            <div class="rysu-logo-wrapper" style="margin: 0 auto 20px;"><div class="rysu-shape">R</div></div>
            <h2>Rysu Global</h2>
            <input type="text" id="username-in" placeholder="Kullanƒ±cƒ± Adƒ±n...">
            <button class="action-btn" onclick="login()" style="width:100%">Giri≈ü Yap</button>
        </div>
    </div>

    <div id="server-modal">
        <div class="modal-box">
            <h3>Yeni Sunucu Olu≈ütur</h3>
            <p style="font-size: 12px; color: #888;">Sunucunun adƒ±nƒ± belirle ve d√ºnyanƒ± kur.</p>
            <input type="text" id="new-server-name" placeholder="Sunucu adƒ±...">
            <div style="display:flex; gap:10px; justify-content: center;">
                <button class="action-btn" onclick="confirmAddServer()">Olu≈ütur</button>
                <button class="action-btn" style="background:#333; color:white;" onclick="closeModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <div class="server-sidebar">
        <div class="rysu-logo-wrapper"><div class="rysu-shape">R</div></div>
        <div id="server-list"></div>
        <div class="server-btn" onclick="openModal()" style="font-size: 24px; color: var(--neon);">+</div>
    </div>

    <div class="channel-sidebar">
        <div class="sidebar-header">
            <span id="active-server-name">Sunucu Se√ß</span>
            <span style="cursor:pointer" onclick="addChannel()">+</span>
        </div>
        <div id="channel-list" style="padding: 10px;"></div>
    </div>

    <div class="main-chat">
        <div class="sidebar-header" style="height: 60px; border-bottom: 1px solid #111;">
            <span id="active-channel-name"># genel</span>
        </div>
        <div class="messages" id="msg-list"></div>
        <div class="input-area">
            <label class="file-btn" title="Dosya G√∂nder">
                üìé<input type="file" id="file-input" style="display:none" onchange="uploadFile(this)">
            </label>
            <div class="input-container">
                <input type="text" id="msg-input" placeholder="Mesaj g√∂nder veya dosya ekle...">
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCXca2LRaHFx6iZX9vhfe6lXMS9UY5nO54",
            authDomain: "rysu-server.firebaseapp.com",
            projectId: "rysu-server",
            databaseURL: "https://rysu-server-default-rtdb.firebaseio.com",
            storageBucket: "rysu-server.appspot.com", // Storage'ƒ± aktif etmen gerekebilir
            appId: "1:253844771451:web:bd370ae5a93eae66fcc8de"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentUser = localStorage.getItem('rysu_name');
        let currentServer = 'Global';
        let currentChannel = 'genel';

        if(currentUser) document.getElementById('auth-screen').style.display = 'none';

        function login() {
            const name = document.getElementById('username-in').value;
            if(!name) return;
            localStorage.setItem('rysu_name', name);
            location.reload();
        }

        // --- MODAL KONTROLLERƒ∞ ---
        function openModal() { document.getElementById('server-modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('server-modal').style.display = 'none'; }

        function confirmAddServer() {
            const sName = document.getElementById('new-server-name').value;
            if(sName) {
                db.ref('servers/' + sName).set({ name: sName, icon: sName[0].toUpperCase() });
                closeModal();
            }
        }

        db.ref('servers').on('value', snap => {
            const list = document.getElementById('server-list');
            list.innerHTML = "";
            snap.forEach(s => {
                const data = s.val();
                list.innerHTML += `<div class="server-btn" onclick="switchServer('${data.name}')">${data.icon}</div>`;
            });
        });

        function switchServer(name) {
            currentServer = name;
            document.getElementById('active-server-name').innerText = name;
            loadChannels();
        }

        function addChannel() {
            const cName = prompt("Kanal Adƒ±:");
            if(cName) db.ref('channels/' + currentServer + '/' + cName).set({ name: cName });
        }

        function loadChannels() {
            db.ref('channels/' + currentServer).on('value', snap => {
                const list = document.getElementById('channel-list');
                list.innerHTML = "";
                snap.forEach(c => {
                    const data = c.val();
                    list.innerHTML += `<div style="padding:10px; cursor:pointer" onclick="switchChannel('${data.name}')"># ${data.name}</div>`;
                });
            });
        }

        function switchChannel(name) {
            currentChannel = name;
            document.getElementById('active-channel-name').innerText = "# " + name;
            listenMessages();
        }

        // --- DOSYA VE MESAJ Sƒ∞STEMƒ∞ ---
        async function uploadFile(input) {
            const file = input.files[0];
            if(!file) return;
            
            // Dosyayƒ± Base64 olarak g√∂nderiyoruz (Basitlik i√ßin, b√ºy√ºk dosyalar i√ßin Storage √∂nerilir)
            const reader = new FileReader();
            reader.onload = function(e) {
                const isImage = file.type.startsWith('image/');
                sendMessage(e.target.result, isImage ? 'image' : 'file', file.name);
            };
            reader.readAsDataURL(file);
        }

        function sendMessage(content, type = 'text', fileName = '') {
            db.ref('msgs/' + currentServer + '/' + currentChannel).push({
                user: currentUser,
                content: content,
                type: type,
                fileName: fileName,
                time: Date.now()
            });
        }

        document.getElementById('msg-input').onkeypress = (e) => {
            if(e.key === 'Enter' && e.target.value.trim() !== "") {
                sendMessage(e.target.value);
                e.target.value = "";
            }
        };

        function listenMessages() {
            db.ref('msgs/' + currentServer + '/' + currentChannel).on('value', snap => {
                const list = document.getElementById('msg-list');
                list.innerHTML = "";
                snap.forEach(m => {
                    const d = m.val();
                    let contentHTML = d.content;
                    if(d.type === 'image') {
                        contentHTML = `<img src="${d.content}" class="shared-img">`;
                    } else if(d.type === 'file') {
                        contentHTML = `<a href="${d.content}" download="${d.fileName}" style="color:var(--neon)">üìÅ ${d.fileName}</a>`;
                    }

                    list.innerHTML += `
                        <div class="msg">
                            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=${d.user}" class="pfp">
                            <div class="msg-content">
                                <b>${d.user}</b>
                                ${contentHTML}
                            </div>
                        </div>
                    `;
                });
                list.scrollTop = list.scrollHeight;
            });
        }

        loadChannels();
    </script>
</body>
</html>